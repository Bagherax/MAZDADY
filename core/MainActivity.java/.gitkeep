package mazdady.core;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import mazdady.admin.AdminConfig;
import mazdady.ui.DynamicPopupManager;
import mazdady.ui.StarEffectManager;
import mazdady.user.UserManager;

public class MainActivity extends AppCompatActivity {
    private DynamicPopupManager popupManager;
    private TextView balanceView;
    private Button buyButton, sellButton;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        AdminConfig.getInstance().loadFromServer();

        balanceView = findViewById(R.id.balance_view);
        buyButton = findViewById(R.id.buy_button);
        sellButton = findViewById(R.id.sell_button);

        popupManager = new DynamicPopupManager(this);

        double balance = UserManager.getInstance().getCurrentUser().getBalance();
        balanceView.setText("ุงูุฑุตูุฏ: " + String.format("%.2f", balance) + " MAZDADY");

        buyButton.setOnClickListener(v -> showBuyPopup());
        sellButton.setOnClickListener(v -> showSellPopup());

        if (UserManager.getInstance().getCurrentUser().hasRecentProfit()) {
            StarEffectManager.showStar(this, findViewById(R.id.main_container));
        }
    }

    private void showBuyPopup() {
        String content = "ุงุฎุชุฑ ุนุฏุฏ ุงูุนููุงุช ุงูุชู ุชุฑูุฏ ุดุฑุงุคูุง:\n\n" +
                        "โข ุงูุญุฏ ุงูุฃุฏูู: 1 MAZDADY\n" +
                        "โข ููููู ุงุณุชุฎุฏุงู ุฑุตูุฏู ุฃู ูุญูุธุชู ุงูุฑูููุฉ.\n\n" +
                        "ููุงุญุธุฉ: ุณุนุฑ ุงูุดุฑุงุก ุงูุญุงูู ูุนุชูุฏ ุนูู ูุดุงุท ุงูุณูู.";
        popupManager.showScrollablePopup("ุดุฑุงุก MAZDADY", content);
    }

    private void showSellPopup() {
        String content = "ุญุฏุฏ ูููุฉ ุงูุนููุงุช ุงูุชู ุชุฑูุฏ ุจูุนูุง:\n\n" +
                        "โข ุณูุชู ุฎุตู ุถุฑูุจุฉ ุงูุณุญุจ ุชููุงุฆููุง.\n" +
                        "โข ุงูุฃุฑุจุงุญ ุชูุญูู ุฅูู ูุญูุธุชู ุจุนุฏ ุงูุชุญูู.\n\n" +
                        "ุชูุจูู: ูุง ูููู ุงูุณุญุจ ุฅูุง ุจุนุฏ ุชูุซูู ุงููููุฉ.";
        popupManager.showScrollablePopup("ุจูุน MAZDADY", content);
    }
}
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // ... (ุงูููุฏ ุงูุณุงุจู)

    // ุฅุถุงูุฉ ุงูุฒุฑ ุงูุนุงุฆู
    setupFloatingAdButton();
}

private void setupFloatingAdButton() {
    AdminConfig.UIConfig uiConfig = AdminConfig.getInstance().getUIConfig();
    if (!uiConfig.getFloatingAdConfig().isEnabled()) return;

    FloatingAdButton adButton = new FloatingAdButton(this, null);
    adButton.configure(
        uiConfig.getFloatingAdConfig().getDisplayDuration(),
        uiConfig.getFloatingAdConfig().getHideDuration(),
        uiConfig.getFloatingAdConfig().getAdImageUrl()
    );

    FrameLayout.LayoutParams params = new FrameLayout.LayoutParams(
        120, 120, Gravity.BOTTOM | Gravity.END
    );
    params.rightMargin = 20;
    params.bottomMargin = 20;

    ((ViewGroup) findViewById(android.R.id.content)).addView(adButton, params);
}
// ุฃุถู ูุฐุง ุฅูู ููุงูุฉ onCreate
private void checkForNewUser() {
    if (UserManager.getInstance().isNewUser()) {
        showSignUpPopup();
    }
}

private void showSignUpPopup() {
    String content = "ูุฑุญุจูุง ุจู ูู MAZDADY! ๐\n\n" +
                    "ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏุฎูู:\n" +
                    "โข ุฑูู ุงููุงุชู\n" +
                    "โข ุงูุจุฑูุฏ ุงูุฅููุชุฑููู\n" +
                    "โข Google / Facebook / TikTok\n\n" +
                    "ุงุจุฏุฃ ุฑุญูุชู ุงููุงููุฉ ุงูุฐููุฉ ุงูุขู!";
    popupManager.showScrollablePopup("ูุฑุญุจูุง ุจู!", content);
}
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // ... (ุงูููุฏ ุงูุณุงุจู)

    // ุชุทุจูู ุงูุชุฎุทูุท ุงูุฏููุงูููู ุจุนุฏ ุชุญููู ุงูุฅุนุฏุงุฏุงุช
    AdminConfig.getInstance().loadFromServer();
    new DynamicLayoutManager((ViewGroup) findViewById(android.R.id.content)).applyLayout();
}
// ุชุญููู ุญุงูุฉ ุงููุณุชุฎุฏู
UserManager userManager = UserManager.getInstance(this);
User user = userManager.getCurrentUser();

// ุงูุชุญูู ูู ุงูููุฒุงุช
if (LevelManager.canAccessFeature("payment_tools", user.getLevel())) {
    findViewById(R.id.payment_tools).setVisibility(View.VISIBLE);
}

// ุงูุชุญูู ูู ุงูุงุดุชุฑุงู
if (userManager.hasActiveSubscription()) {
    // ุฅุธูุงุฑ ููุฒุงุช Premium
}
// ุนูุฏ ุงูููุฑ ุนูู ุฒุฑ ุงูุณุญุจ
findViewById(R.id.withdraw_button).setOnClickListener(v -> {
    WalletManager walletManager = new WalletManager();
    if (walletManager.getConnector().isConnected()) {
        boolean success = walletManager.withdrawMAZDADY(100.0);
        if (success) {
            showPopup("ุชู ุงูุณุญุจ ุจูุฌุงุญ!");
        }
    } else {
        showWalletConnectionPopup();
    }
});
// ุนูุฏ ุงูููุฑ ุนูู ุฒุฑ ุงูุณุญุจ
findViewById(R.id.withdraw_button).setOnClickListener(v -> {
    WalletManager walletManager = new WalletManager();
    if (walletManager.getConnector().isConnected()) {
        boolean success = walletManager.withdrawMAZDADY(100.0);
        if (success) {
            showPopup("ุชู ุงูุณุญุจ ุจูุฌุงุญ!");
        }
    } else {
        showWalletConnectionPopup();
    }
});
// ุงูุชุญูู ูู ุงูุฃูุงู ุนูุฏ ุงูุชุดุบูู
if (RootDetection.isDeviceRooted()) {
    new SecurityMonitor(this).reportSuspiciousActivity("ROOTED_DEVICE");
}

if (!AppIntegrityChecker.isAppIntegrityValid(this)) {
    new SecurityMonitor(this).reportSuspiciousActivity("MODIFIED_APP");
}
// ุชููุฆุฉ ุงูุชุฑุฌูุฉ
TranslationManager translationManager = new TranslationManager(this);

// ุชุฑุฌูุฉ ุงูุนูุงุตุฑ
balanceView.setText(translationManager.getString("balance_label", "9891.26"));
buyButton.setText(translationManager.getString("buy_button"));
sellButton.setText(translationManager.getString("sell_button"));

// ุชุบููุฑ ุงููุบุฉ ุฏููุงูููููุง
translationManager.changeLanguage("en"); // ุชุบููุฑ ุฅูู ุงูุฅูุฌููุฒูุฉ
}
// ุชุฑุฌูุฉ ููุฑูุฉ ูุฃู ูุต
RealTimeTranslator translator = RealTimeTranslator.getInstance();
String translated = translator.translateToArabic("Hello, how are you?");
// ุงููุงุชุฌ: "[ูุชุฑุฌู ุฅูู ุงูุนุฑุจูุฉ] Hello, how are you?"

// ุชุฑุฌูุฉ ูู ุงูุนุฑุจูุฉ ุฅูู ูุบุฉ ุงููุณุชุฎุฏู
String userLangText = translator.translateToUserLanguage("ูุฑุญุจุง ุจู ูู MAZDADY!");
}
onCreate
dev.UnitTests.runAllTests();
}
package mazdady.core;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import mazdady.admin.AdminConfig;
import mazdady.ui.DynamicPopupManager;
import mazdady.ui.StarEffectManager;
import mazdady.user.UserManager;

/**
 * ุงููุดุงุท ุงูุฑุฆูุณู ูุน ุฏุนู ุงูุชููุฆุฉ ุงูุฏููุงููููุฉ
 * ูุชุจุน ููุท Template Method ููุตู ุฎุทูุงุช ุงูุชููุฆุฉ
 */
public final class MainActivity extends AppCompatActivity {
    private DynamicPopupManager popupManager;
    private TextView balanceView;
    private Button buyButton, sellButton;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        // ุชููุฆุฉ ุงูููููุงุช ุงูุฃุณุงุณูุฉ
        initializeComponents();
        
        // ุชููุฆุฉ ูุงุฌูุฉ ุงููุณุชุฎุฏู
        initializeUI();
        
        // ุชููุฆุฉ ุงูุฃุญุฏุงุซ
        initializeEventHandlers();
        
        // ุนุฑุถ ุชุฃุซูุฑุงุช ุงูุชุฑุญูุจ
        showWelcomeEffects();
    }

    private void initializeComponents() {
        AdminConfig.getInstance().loadFromServer();
        popupManager = new DynamicPopupManager(this);
    }

    private void initializeUI() {
        balanceView = findViewById(R.id.balance_view);
        buyButton = findViewById(R.id.buy_button);
        sellButton = findViewById(R.id.sell_button);

        // ุชุญููู ุฑุตูุฏ ุงููุณุชุฎุฏู
        double balance = UserManager.getInstance(this).getCurrentUser().getBalance();
        balanceView.setText("ุงูุฑุตูุฏ: " + String.format("%.2f", balance) + " MAZDADY");

        // ุชุทุจูู ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ ูู ููุญุฉ ุงูุชุญูู
        applyDynamicUI();
    }

    private void initializeEventHandlers() {
        buyButton.setOnClickListener(v -> showBuyPopup());
        sellButton.setOnClickListener(v -> showSellPopup());
    }

    private void showWelcomeEffects() {
        if (UserManager.getInstance(this).getCurrentUser().hasRecentProfit()) {
            StarEffectManager.showStar(this, findViewById(R.id.main_container));
        }
    }

    private void applyDynamicUI() {
        // ูู ุงูุฅูุชุงุฌ: ุชุทุจูู ุงูุฅุนุฏุงุฏุงุช ูู AdminConfig
        // ูุซู ุงูุฃููุงูุ ุงูุฃุญุฌุงูุ ุงูุฑุคูุฉ
    }

    private void showBuyPopup() {
        String content = "ุงุฎุชุฑ ุนุฏุฏ ุงูุนููุงุช ุงูุชู ุชุฑูุฏ ุดุฑุงุคูุง:\n\n" +
                        "โข ุงูุญุฏ ุงูุฃุฏูู: 1 MAZDADY\n" +
                        "โข ููููู ุงุณุชุฎุฏุงู ุฑุตูุฏู ุฃู ูุญูุธุชู ุงูุฑูููุฉ.\n\n" +
                        "ููุงุญุธุฉ: ุณุนุฑ ุงูุดุฑุงุก ุงูุญุงูู ูุนุชูุฏ ุนูู ูุดุงุท ุงูุณูู.";
        popupManager.showScrollablePopup("ุดุฑุงุก MAZDADY", content);
    }

    private void showSellPopup() {
        String content = "ุญุฏุฏ ูููุฉ ุงูุนููุงุช ุงูุชู ุชุฑูุฏ ุจูุนูุง:\n\n" +
                        "โข ุณูุชู ุฎุตู ุถุฑูุจุฉ ุงูุณุญุจ ุชููุงุฆููุง.\n" +
                        "โข ุงูุฃุฑุจุงุญ ุชูุญูู ุฅูู ูุญูุธุชู ุจุนุฏ ุงูุชุญูู.\n\n" +
                        "ุชูุจูู: ูุง ูููู ุงูุณุญุจ ุฅูุง ุจุนุฏ ุชูุซูู ุงููููุฉ.";
        popupManager.showScrollablePopup("ุจูุน MAZDADY", content);
    }
}