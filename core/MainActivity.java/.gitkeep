package mazdady.core;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import mazdady.admin.AdminConfig;
import mazdady.ui.DynamicPopupManager;
import mazdady.ui.StarEffectManager;
import mazdady.user.UserManager;

public class MainActivity extends AppCompatActivity {
    private DynamicPopupManager popupManager;
    private TextView balanceView;
    private Button buyButton, sellButton;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        AdminConfig.getInstance().loadFromServer();

        balanceView = findViewById(R.id.balance_view);
        buyButton = findViewById(R.id.buy_button);
        sellButton = findViewById(R.id.sell_button);

        popupManager = new DynamicPopupManager(this);

        double balance = UserManager.getInstance().getCurrentUser().getBalance();
        balanceView.setText("Ø§Ù„Ø±ØµÙŠØ¯: " + String.format("%.2f", balance) + " MAZDADY");

        buyButton.setOnClickListener(v -> showBuyPopup());
        sellButton.setOnClickListener(v -> showSellPopup());

        if (UserManager.getInstance().getCurrentUser().hasRecentProfit()) {
            StarEffectManager.showStar(this, findViewById(R.id.main_container));
        }
    }

    private void showBuyPopup() {
        String content = "Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø´Ø±Ø§Ø¤Ù‡Ø§:\n\n" +
                        "â€¢ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 1 MAZDADY\n" +
                        "â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±ØµÙŠØ¯Ùƒ Ø£Ùˆ Ù…Ø­ÙØ¸ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©.\n\n" +
                        "Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù†Ø´Ø§Ø· Ø§Ù„Ø³ÙˆÙ‚.";
        popupManager.showScrollablePopup("Ø´Ø±Ø§Ø¡ MAZDADY", content);
    }

    private void showSellPopup() {
        String content = "Ø­Ø¯Ø¯ ÙƒÙ…ÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¨ÙŠØ¹Ù‡Ø§:\n\n" +
                        "â€¢ Ø³ÙŠØªÙ… Ø®ØµÙ… Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø­Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.\n" +
                        "â€¢ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ØªÙØ­ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚.\n\n" +
                        "ØªÙ†Ø¨ÙŠÙ‡: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø³Ø­Ø¨ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù‡ÙˆÙŠØ©.";
        popupManager.showScrollablePopup("Ø¨ÙŠØ¹ MAZDADY", content);
    }
}
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // ... (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…
    setupFloatingAdButton();
}

private void setupFloatingAdButton() {
    AdminConfig.UIConfig uiConfig = AdminConfig.getInstance().getUIConfig();
    if (!uiConfig.getFloatingAdConfig().isEnabled()) return;

    FloatingAdButton adButton = new FloatingAdButton(this, null);
    adButton.configure(
        uiConfig.getFloatingAdConfig().getDisplayDuration(),
        uiConfig.getFloatingAdConfig().getHideDuration(),
        uiConfig.getFloatingAdConfig().getAdImageUrl()
    );

    FrameLayout.LayoutParams params = new FrameLayout.LayoutParams(
        120, 120, Gravity.BOTTOM | Gravity.END
    );
    params.rightMargin = 20;
    params.bottomMargin = 20;

    ((ViewGroup) findViewById(android.R.id.content)).addView(adButton, params);
}
// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© onCreate
private void checkForNewUser() {
    if (UserManager.getInstance().isNewUser()) {
        showSignUpPopup();
    }
}

private void showSignUpPopup() {
    String content = "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ MAZDADY! ğŸŒŸ\n\n" +
                    "Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:\n" +
                    "â€¢ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ\n" +
                    "â€¢ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ\n" +
                    "â€¢ Google / Facebook / TikTok\n\n" +
                    "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ø¢Ù†!";
    popupManager.showScrollablePopup("Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ!", content);
}
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // ... (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    AdminConfig.getInstance().loadFromServer();
    new DynamicLayoutManager((ViewGroup) findViewById(android.R.id.content)).applyLayout();
}
// ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
UserManager userManager = UserManager.getInstance(this);
User user = userManager.getCurrentUser();

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙŠØ²Ø§Øª
if (LevelManager.canAccessFeature("payment_tools", user.getLevel())) {
    findViewById(R.id.payment_tools).setVisibility(View.VISIBLE);
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
if (userManager.hasActiveSubscription()) {
    // Ø¥Ø¸Ù‡Ø§Ø± Ù…ÙŠØ²Ø§Øª Premium
}
// Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø³Ø­Ø¨
findViewById(R.id.withdraw_button).setOnClickListener(v -> {
    WalletManager walletManager = new WalletManager();
    if (walletManager.getConnector().isConnected()) {
        boolean success = walletManager.withdrawMAZDADY(100.0);
        if (success) {
            showPopup("ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
        }
    } else {
        showWalletConnectionPopup();
    }
});
// Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø³Ø­Ø¨
findViewById(R.id.withdraw_button).setOnClickListener(v -> {
    WalletManager walletManager = new WalletManager();
    if (walletManager.getConnector().isConnected()) {
        boolean success = walletManager.withdrawMAZDADY(100.0);
        if (success) {
            showPopup("ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
        }
    } else {
        showWalletConnectionPopup();
    }
});
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
if (RootDetection.isDeviceRooted()) {
    new SecurityMonitor(this).reportSuspiciousActivity("ROOTED_DEVICE");
}

if (!AppIntegrityChecker.isAppIntegrityValid(this)) {
    new SecurityMonitor(this).reportSuspiciousActivity("MODIFIED_APP");
}
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø©
TranslationManager translationManager = new TranslationManager(this);

// ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±
balanceView.setText(translationManager.getString("balance_label", "9891.26"));
buyButton.setText(translationManager.getString("buy_button"));
sellButton.setText(translationManager.getString("sell_button"));

// ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§
translationManager.changeLanguage("en"); // ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
}
// ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ© Ù„Ø£ÙŠ Ù†Øµ
RealTimeTranslator translator = RealTimeTranslator.getInstance();
String translated = translator.translateToArabic("Hello, how are you?");
// Ø§Ù„Ù†Ø§ØªØ¬: "[Ù…ØªØ±Ø¬Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©] Hello, how are you?"

// ØªØ±Ø¬Ù…Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ù„ØºØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
String userLangText = translator.translateToUserLanguage("Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ MAZDADY!");
}