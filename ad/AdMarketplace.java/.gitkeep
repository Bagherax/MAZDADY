package mazdady.ad;

import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;
import java.util.function.Predicate;
import java.util.stream.Collectors;

/**
 * سوق الإعلانات مع دعم العمليات الآمنة متعددة الخيوط
 * يدعم التصفية والبحث باستخدام التعبيرات الوظيفية
 */
public final class AdMarketplace {
    private final List<AdCampaign> campaigns = new CopyOnWriteArrayList<>();

    public void publishCampaign(AdCampaign campaign) {
        campaigns.add(campaign);
    }

    public List<AdCampaign> findCampaigns(Predicate<AdCampaign> filter) {
        return campaigns.stream()
            .filter(filter)
            .collect(Collectors.toList());
    }

    public List<AdCampaign> getActiveCampaigns() {
        return findCampaigns(camp -> camp.getStatus() == AdCampaign.CampaignStatus.ACTIVE);
    }

    public AdCampaign findById(String campaignId) {
        return campaigns.stream()
            .filter(camp -> camp.getId().equals(campaignId))
            .findFirst()
            .orElse(null);
    }

    public void removeCampaign(String campaignId) {
        campaigns.removeIf(camp -> camp.getId().equals(campaignId));
    }

    public int size() {
        return campaigns.size();
    }
}