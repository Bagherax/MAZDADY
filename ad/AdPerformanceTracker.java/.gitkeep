package mazdady.ad;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class AdPerformanceTracker {
    private Map<String, AdCampaign> activeCampaigns = new HashMap<>();
    private ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);

    public void startTracking(AdCampaign campaign) {
        activeCampaigns.put(campaign.getCampaignId(), campaign);
        
        // تحديث التقدم كل 30 ثانية (في الإنتاج: من API خارجي)
        scheduler.scheduleAtFixedRate(() -> {
            simulateProgress(campaign);
        }, 0, 30, TimeUnit.SECONDS);
    }

    private void simulateProgress(AdCampaign campaign) {
        if (!campaign.isActive()) return;
        
        // في الإنتاج: جلب البيانات من YouTube/TikTok API
        int newProgress = campaign.getCurrentProgress() + 5;
        campaign.updateProgress(newProgress);
        
        if (campaign.isCompleted()) {
            activeCampaigns.remove(campaign.getCampaignId());
            notifyCampaignCompleted(campaign);
        }
    }

    private void notifyCampaignCompleted(AdCampaign campaign) {
        // إرسال إشعار للمستخدم
        System.out.println("تم الانتهاء من حملتك! 🎉");
    }

    public AdCampaign getCampaign(String campaignId) {
        return activeCampaigns.get(campaignId);
    }
}