package mazdady.ad;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.function.Consumer;

/**
 * متتبع أداء الحملات مع دعم المراقبة الزمنية
 * يستخدم Observer Pattern لإعلام المستمعين بالتغيرات
 */
public final class AdPerformanceTracker {
    private final Map<String, AdCampaign> activeCampaigns = new ConcurrentHashMap<>();
    private final Consumer<AdCampaign> onCompletion;

    public AdPerformanceTracker(Consumer<AdCampaign> onCompletion) {
        this.onCompletion = onCompletion;
    }

    public void startTracking(AdCampaign campaign) {
        activeCampaigns.put(campaign.getId(), campaign);
        // في الإنتاج: بدء جدولة المراقبة
    }

    public void updateProgress(String campaignId, int progress) {
        AdCampaign campaign = activeCampaigns.get(campaignId);
        if (campaign != null && campaign.isCompleted(progress)) {
            activeCampaigns.remove(campaignId);
            onCompletion.accept(campaign);
        }
    }

    public AdCampaign getCampaign(String campaignId) {
        return activeCampaigns.get(campaignId);
    }
}