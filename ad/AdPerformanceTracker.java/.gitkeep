package mazdady.ad;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class AdPerformanceTracker {
    private Map<String, AdCampaign> activeCampaigns = new HashMap<>();
    private ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);

    public void startTracking(AdCampaign campaign) {
        activeCampaigns.put(campaign.getCampaignId(), campaign);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© (ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ù…Ù† API Ø®Ø§Ø±Ø¬ÙŠ)
        scheduler.scheduleAtFixedRate(() -> {
            simulateProgress(campaign);
        }, 0, 30, TimeUnit.SECONDS);
    }

    private void simulateProgress(AdCampaign campaign) {
        if (!campaign.isActive()) return;
        
        // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† YouTube/TikTok API
        int newProgress = campaign.getCurrentProgress() + 5;
        campaign.updateProgress(newProgress);
        
        if (campaign.isCompleted()) {
            activeCampaigns.remove(campaign.getCampaignId());
            notifyCampaignCompleted(campaign);
        }
    }

    private void notifyCampaignCompleted(AdCampaign campaign) {
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        System.out.println("ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø­Ù…Ù„ØªÙƒ! ğŸ‰");
    }

    public AdCampaign getCampaign(String campaignId) {
        return activeCampaigns.get(campaignId);
    }
}