package mazdady.ad;

import mazdady.user.UserManager;

import java.util.function.Predicate;

/**
 * مدير إعلانات الإنقاذ مع دعم قواعد التفعيل الديناميكية
 * يستخدم Functional Programming لتحديد شروط العرض
 */
public final class RescueAdManager {
    private final Predicate<Double> rescueCondition = balance -> balance < 10.0;

    public boolean shouldOfferRescueAd() {
        double balance = UserManager.getInstance(null).getCurrentUser().getBalance();
        return rescueCondition.test(balance);
    }

    public AdCampaign createRescueCampaign(String userId) {
        return new AdCampaign.Builder()
            .userId(userId)
            .platform(AdCampaign.Platform.TIKTOK)
            .contentUrl("https://tiktok.com/rescue")
            .goal(AdCampaign.Goal.VIEWS)
            .targetCount(100)
            .budget(5.0)
            .build();
    }

    public void activateRescueAd(String userId) {
        AdCampaign rescueCampaign = createRescueCampaign(userId);
        AdManager.getInstance().createCampaignAsync(
            rescueCampaign.getPlatform(),
            rescueCampaign.getContentUrl(),
            rescueCampaign.getGoal(),
            rescueCampaign.getTargetCount(),
            rescueCampaign.getBudget()
        );
    }
}