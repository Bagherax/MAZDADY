package mazdady.ad;

import java.util.function.Predicate;

/**
 * محرك إزالة الإعلانات مع دعم القواعد الديناميكية
 * يتبع نمط Strategy لتحديد شروط الإزالة
 */
public final class AdRemovalEngine {
    private final AdMarketplace marketplace;
    private final AdDeliveryEngine deliveryEngine;

    public AdRemovalEngine(AdMarketplace marketplace, AdDeliveryEngine deliveryEngine) {
        this.marketplace = marketplace;
        this.deliveryEngine = deliveryEngine;
    }

    public void removeCompletedCampaigns() {
        removeCampaignsByRule(camp -> camp.getStatus() == AdCampaign.CampaignStatus.COMPLETED);
    }

    public void removeExpiredCampaigns() {
        // في الإنتاج: التحقق من انتهاء المدة
        removeCampaignsByRule(camp -> false);
    }

    public void removeCampaignsByRule(Predicate<AdCampaign> removalRule) {
        marketplace.findCampaigns(removalRule).forEach(camp -> {
            marketplace.removeCampaign(camp.getId());
            System.out.println("Removed campaign: " + camp.getId());
        });
    }

    public void forceRemoveCampaign(String campaignId) {
        marketplace.removeCampaign(campaignId);
    }
}