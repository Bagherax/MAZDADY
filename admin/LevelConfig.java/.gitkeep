package mazdady.admin;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

/**
 * Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
 * ÙŠØªØ¨Ø¹ Ù†Ù…Ø· Builder Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§
 */
public final class LevelConfig {
    private final Map<Integer, LevelDefinition> levelDefinitions = new ConcurrentHashMap<>();
    private static LevelConfig instance;

    private LevelConfig() {
        initializeDefaultLevelDefinitions();
    }

    public static synchronized LevelConfig getInstance() {
        if (instance == null) {
            instance = new LevelConfig();
        }
        return instance;
    }

    private void initializeDefaultLevelDefinitions() {
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        levelDefinitions.put(1, new LevelDefinition(1, 100, "Ù…Ø¨ØªØ¯Ø¦", "ğŸ¥‰", "#FFD700"));
        levelDefinitions.put(2, new LevelDefinition(2, 1000, "Ù…ØªÙ‚Ø¯Ù…", "ğŸ¥ˆ", "#C0C0C0"));
        levelDefinitions.put(3, new LevelDefinition(3, 5000, "Ø®Ø¨ÙŠØ±", "ğŸ¥‡", "#FFD700"));
        levelDefinitions.put(4, new LevelDefinition(4, 10000, "Ù…Ø§Ø¬Ø³ØªÙŠØ±", "ğŸ†", "#4CAF50"));
        levelDefinitions.put(5, new LevelDefinition(5, 25000, "Ø£Ø³ØªØ§Ø°", "ğŸ‘‘", "#2196F3"));
        
        System.out.println("LEVEL CONFIG: Initialized " + levelDefinitions.size() + " default level definitions");
    }

    /**
     * ØªØ­Ø¯ÙŠØ« ØªØ¹Ø±ÙŠÙ Ù…Ø³ØªÙˆÙ‰ Ù…Ø¹ÙŠÙ†
     */
    public void updateLevelDefinition(int level, LevelDefinition definition) {
        if (level > 0 && definition != null) {
            levelDefinitions.put(level, definition);
            System.out.println("LEVEL CONFIG: Updated level " + level + " definition");
        }
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© ØªØ¹Ø±ÙŠÙ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
     */
    public void addLevelDefinition(int level, int requiredWins, String levelName, 
                                 String badgeEmoji, String badgeColor) {
        LevelDefinition definition = new LevelDefinition(level, requiredWins, levelName, badgeEmoji, badgeColor);
        levelDefinitions.put(level, definition);
        System.out.println("LEVEL CONFIG: Added level " + level + " definition");
    }

    /**
     * Ø¥Ø²Ø§Ù„Ø© ØªØ¹Ø±ÙŠÙ Ù…Ø³ØªÙˆÙ‰
     */
    public void removeLevelDefinition(int level) {
        LevelDefinition removed = levelDefinitions.remove(level);
        if (removed != null) {
            System.out.println("LEVEL CONFIG: Removed level " + level + " definition");
        }
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¹Ø±ÙŠÙ Ù…Ø³ØªÙˆÙ‰ Ù…Ø¹ÙŠÙ†
     */
    public LevelDefinition getLevelDefinition(int level) {
        return levelDefinitions.get(level);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
     */
    public Map<Integer, LevelDefinition> getLevelDefinitions() {
        return new ConcurrentHashMap<>(levelDefinitions);
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ¹Ø±ÙŠÙ Ù…Ø³ØªÙˆÙ‰
     */
    public boolean hasLevelDefinition(int level) {
        return levelDefinitions.containsKey(level);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù…Ø¹Ø±Ù
     */
    public int getMaxDefinedLevel() {
        return levelDefinitions.keySet().stream().mapToInt(Integer::intValue).max().orElse(1);
    }

    /**
     * Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª)
     */
    public void clearAllLevelDefinitions() {
        levelDefinitions.clear();
        System.out.println("LEVEL CONFIG: Cleared all level definitions");
    }

    // --- ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ---
    public static final class LevelDefinition {
        private final int level;
        private final int requiredWins;
        private final String levelName;
        private final String badgeEmoji;
        private final String badgeColor;

        public LevelDefinition(int level, int requiredWins, String levelName, 
                              String badgeEmoji, String badgeColor) {
            this.level = level;
            this.requiredWins = requiredWins;
            this.levelName = levelName;
            this.badgeEmoji = badgeEmoji;
            this.badgeColor = badgeColor;
        }

        // Getters
        public int getLevel() { return level; }
        public int getRequiredWins() { return requiredWins; }
        public String getLevelName() { return levelName; }
        public String getBadgeEmoji() { return badgeEmoji; }
        public String getBadgeColor() { return badgeColor; }
        
        @Override
        public String toString() {
            return "LevelDefinition{" +
                "level=" + level +
                ", requiredWins=" + requiredWins +
                ", levelName='" + levelName + '\'' +
                ", badgeEmoji='" + badgeEmoji + '\'' +
                ", badgeColor='" + badgeColor + '\'' +
                '}';
        }
    }

    // --- Builders ---
    public static final class LevelDefinitionBuilder {
        private int level;
        private int requiredWins;
        private String levelName;
        private String badgeEmoji;
        private String badgeColor;

        public LevelDefinitionBuilder level(int level) { this.level = level; return this; }
        public LevelDefinitionBuilder requiredWins(int requiredWins) { this.requiredWins = requiredWins; return this; }
        public LevelDefinitionBuilder levelName(String levelName) { this.levelName = levelName; return this; }
        public LevelDefinitionBuilder badgeEmoji(String badgeEmoji) { this.badgeEmoji = badgeEmoji; return this; }
        public LevelDefinitionBuilder badgeColor(String badgeColor) { this.badgeColor = badgeColor; return this; }

        public LevelDefinition build() {
            return new LevelDefinition(level, requiredWins, levelName, badgeEmoji, badgeColor);
        }
    }

    // --- Getters ---
    public int getLevelDefinitionCount() { return levelDefinitions.size(); }
    public boolean isEmpty() { return levelDefinitions.isEmpty(); }
    
    /**
     * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª)
     */
    public void reset() {
        levelDefinitions.clear();
        initializeDefaultLevelDefinitions();
        System.out.println("LEVEL CONFIG: Reset completed");
    }
}